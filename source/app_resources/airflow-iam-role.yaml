- Effect: Allow
  Action: 
  - airflow:PublishMetrics
  Resource:
  - arn:aws:airflow:{{REGION}}:{{AccountID}}:environment/{{env_name}}
- Effect: Deny
  Action:
  - s3:ListAllMyBuckets
  Resource:
  - arn:aws:s3:::{{codeBucket}}/*
  - arn:aws:s3:::{{codeBucket}}
- Effect: Allow
  Action: 
    - s3:GetObject*
    - s3:GetBucket*
    - s3:List*
    - s3:PutObject
    - s3:DeleteObject
  Resource:
  - arn:aws:s3:::{{codeBucket}}/*
  - arn:aws:s3:::{{codeBucket}}
- Effect: Allow
  Action:    
  - logs:CreateLogStream
  - logs:CreateLogGroup
  - logs:PutLogEvents
  - logs:GetLogEvents
  - logs:GetLogRecord
  - logs:GetLogGroupFields
  - logs:GetQueryResults
  Resource:
  - arn:aws:logs:{{REGION}}:{{AccountID}}:log-group:airflow-{{env_name}}-*
- Effect: Allow
  Action: 
  - s3:GetAccountPublicAccessBlock
  Resource:
    - '*'
- Effect: Allow
  Action: 
  - logs:DescribeLogGroups
  Resource:
    - '*'
- Effect: Allow
  Action: 
  - cloudwatch:PutMetricData
  Resource:
    - '*'    
- Effect: Allow
  Action:
  - sqs:ChangeMessageVisibility
  - sqs:DeleteMessage
  - sqs:GetQueueAttributes
  - sqs:GetQueueUrl
  - sqs:ReceiveMessage
  - sqs:SendMessage
  Resource:
  - arn:aws:sqs:{{REGION}}:*:airflow-celery-*
- Effect: Allow
  Action:
  - kms:*
  Resource: 
  - arn:aws:kms:{{REGION}}:{{AccountID}}:key/*"
  Condition:
    StringLike:
      kms:ViaService:
      - sqs.{{REGION}}.amazonaws.com
      - s3.{{REGION}}.amazonaws.com
- Effect: Allow
  Action:
  - emr-serverless:CreateApplication
  - emr-serverless:ListApplications
  - emr-serverless:GetApplication
  - emr-serverless:StartApplication
  - emr-serverless:StopApplication
  - emr-serverless:DeleteApplication
  - emr-serverless:StartJobRun
  - emr-serverless:CancelJobRun
  - emr-serverless:GetJobRun   
  - emr-serverless:ListJobRuns
  Resource:
    - '*'
- Effect: Allow
  Action:
  - iam:PassRole
  Resource:
  - arn:aws:iam::{{AccountID}}:role/*
  Condition:
    StringLike:
      iam:PassedToService: emr-serverless.amazonaws.com
- Effect: Allow
  Action:
  - ec2:DescribeInstances
  - ec2:CreateNetworkInterface
  - ec2:AttachNetworkInterface
  - ec2:DescribeNetworkInterfaces
  - autoscaling:CompleteLifecycleAction
  - ec2:DeleteNetworkInterface
  Resource:
    - '*'
- Effect: Allow
  Action:
  - ec2:CreateNetworkInterface
  - ec2:DeleteNetworkInterface
  Resource:
  - arn:aws:ec2:*:*:network-interface/*
  Condition:
    StringEquals:
      aws:CalledViaLast: ops.emr-serverless.amazonaws.com